<html>
    <!--TITULO DE PAGINA-->
    <head>
        <title>Lectura</title> 
        <!--APLICACION DE CSS-->
        <link href="css/menu.css" rel="stylesheet">
        <link href="css/estyle2.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">
        <link href="css/formulario.css" rel="stylesheet">
        <link href="css/cuerpo.css" rel="stylesheet">
    </head>
        <!--COLOR DEL CUERPO DE LA PAGINA-->
    <body bgcolor="#FFFFFF">
        <!--TABLA PRINCIPAL-->
        <!--Centra; color-->
        <table border="0" width="95%" align="center" bgcolor="#0B73F8" class="tabla_1" padding="auto">
            <!--TABLA_2--> 
            <tr>
                <td colspan="2">&nbsp;</td>
            </tr>
            <!--FORMULARIO--> 
            <tr>
                <td colspan="1" class="tabla_1" align="center">           
                    <section class="formulario_1">
                        <img src="imagenes/Formulario_Imag.jpeg" class="imagen_formulario">
                        <br>
                        <br>
                        <h4 align="justify" class="parrafos"> "Cada libro es una aventura esperando ser descubierta. Sumergete en la magia de las palabras!" </h4>
                        <h4 align="center">Bienvenido/a</h4>
                        <h4 align="center">Ingresa tus datos</h4>
                        <form id="alumno">
                            <input class="controles" type="text" id="nombre" placeholder="INSERTA EL NOMBRE DEL ESTUDIANTE">
                            <input class="controles" type="text" id="apellido" placeholder="INSERTAR EL APELLIDO DEL ESTUDIANTE">
                            <button class="botones" type="submit">Agregar</button>
                        </form>
                        
                        <tr>
                            <td id="cuerpo">
                                <div id="cuadro-celeste">
                                    <ul id="lista-alumno"></ul>
                                    <script type="module">
                                        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
                                        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

                                        // Configuración de Firebase
                                        // Your web app's Firebase configuration
                                        const firebaseConfig = {
                                        apiKey: "AIzaSyAkV8sXa7n5qe6luXOtcxHhgdd1_EjX04s",
                                        authDomain: "usuario-a1979.firebaseapp.com",
                                        projectId: "usuario-a1979",
                                        storageBucket: "usuario-a1979.appspot.com",
                                        messagingSenderId: "515804654653",
                                        appId: "1:515804654653:web:90bfd1725d1eddd1b48e54"
                                        };
                                        const app = initializeApp(firebaseConfig);
                                        const db = getFirestore(app);

                                        const listaAlumno = document.getElementById("lista-alumno");

                                        function renderAlumno(querySnapshot) {
                                            listaAlumno.innerHTML = "";
                                            querySnapshot.forEach(doc => {
                                                const alumno = doc.data();
                                                const li = document.createElement("li");
                                                li.textContent = `${alumno.nombre} - ${alumno.apellido}`;
                                                const btnEliminar = document.createElement("button");
                                                btnEliminar.textContent = "Eliminar";
                                                btnEliminar.classList.add("botones"); // Agregar clase CSS "botones"
                                                btnEliminar.addEventListener("click", () => {
                                                    eliminarAlumno(doc.id);
                                                });

                                                const btnModificar = document.createElement("button");
                                                btnModificar.textContent = "Modificar";
                                                btnModificar.classList.add("botones"); // Agregar clase CSS "botones"
                                                btnModificar.addEventListener("click", () => {
                                                    modificarAlumno(doc.id, alumno.nombre, alumno.apellido);
                                                });
                                                li.appendChild(btnEliminar);
                                                li.appendChild(btnModificar);
                                                listaAlumno.appendChild(li);
                                            });
                                        }

                                        onSnapshot(collection(db, "alumno"), renderAlumno);

                                        const alumnoForm = document.getElementById("alumno");
                                        alumnoForm.addEventListener("submit", async(e) => {
                                            e.preventDefault();
                                            await addDoc(collection(db, "alumno"), {
                                                nombre: alumnoForm.nombre.value,
                                                apellido: alumnoForm.apellido.value
                                            });
                                            alumnoForm.reset();
                                        });

                                        async function eliminarAlumno(id) {
                                            try {
                                                await deleteDoc(doc(db, "alumno", id));
                                            } catch (error) {
                                                console.error("Error al eliminar el producto:", error);
                                            }
                                        }

                                        async function modificarAlumno(id, nombreActual, apellidoActual) {
                                        const nuevoNombre = prompt("Ingrese el nuevo nombre:", nombreActual);
                                        const nuevoApellido = prompt("Ingrese el nuevo apellido:", apellidoActual);
                                        if (nuevoNombre !== null && nuevoApellido !== null) {
                                            try {
                                                await updateDoc(doc(db, "alumno", id), {  // Corregir la referencia a la colección
                                                    nombre: nuevoNombre,  // Actualizar el nombre
                                                    apellido: nuevoApellido  // Actualizar el apellido
                                                });
                                            } catch (error) {
                                                console.error("Error al modificar el producto:", error);
                                            }
                                        }
                                    }
                                    </script>
                                </div>
                                    
                            </td>
                        </tr>
                    </section>
                </td>
            </tr>
            
            <!--TABLA PIE DEL DISEÑO-->
            <tr>
                <td colspan="2">&nbsp;</td>
            </tr>
        </table>
    </body>
</html>